# Consumer
Consumer (потребитель) в Apache Kafka представляет собой приложение или компонент, 
которое подписано на один или несколько топиков для чтения сообщений.
Consumer в Apache Kafka обычно получает сообщения в виде батчей (групп сообщений) 
из одной или нескольких партиций темы. 
Обработка сообщений в батчах может быть более эффективной,
чем обработка сообщений по одному, поскольку это позволяет уменьшить накладные расходы на сеть 
и увеличить пропускную способность.

```
+-------------------+                          +-------------------+ 
|                   |                          |                   |                   
|  Kafka Consumer   |<-----1.Send message------|  Kafka Broker     |<---+
|                   |                          |                   |    |
+---------+---------+                          +-------------------+    |
          |                                                             |
          |                                                             |
          |                                                             |
          +---------------------- 2. commit offset----------------------+
 
```

## Problems
* Consumer может получить сообщение, но не отправить подтверждение.
* Consumer может получить сообщение, отправить подтверждение, но не смочь обработать сообщение.
* Consumer может упасть после того, как отправил подтверждение, но до того, как обработал сообщение.
  * В этом случае сообщение будет потеряно.
  * Чтобы избежать этого, можно включить ```enable.auto.commit``` и ```auto.commit.interval.ms```

## Consumer settings

* bootstrap.servers: Список адресов брокеров Kafka, к которым будет подключаться Consumer.
  * example: ```bootstrap.servers=broker1:9092,broker2:9092```


## Consumer group settings
* group.id: Идентификатор группы потребителей. Consumer с одним и тем же group.id рассматривается как часть одной группы потребителей.
  * example: ```group.id=my-consumer-group```

консумер имеют лидера, который нужен для того, чтобы координировать работу консьюмеров в группе.

#### Настройки ожидания и получения данных от брокера.
* ```fetch.min.bytes``` - минимальный размер ответа от брокера. если ответ меньше, то брокер ждет пока не наберется достаточное количество данных.
* ```fetch.max.wait.ms``` - максимальное время ожидания ответа от брокера. если за это время не набралось достаточное количество данных, то брокер все равно отправляет ответ.
* ```max.partition.fetch.bytes``` - максимальный размер ответа от брокера на запрос по одной партиции.
* ```session.timeout.ms``` - время, которое брокер ждет подтверждения от консьюмера. если консьюмер не подтвердил получение данных за это время, то брокер считает, что консьюмер умер и перевыдает партиции другим консьюмерам.

#### Автоматическое управление оффсетами/автоматическое подтверждение получения данных
* ```auto.commit.enabled``` - включить автоматическое подтверждение получения данных
* ```auto.commit.interval.ms``` - интервал между автоматическими подтверждениями получения данных.
* ```session.timeout.ms``` - время, которое брокер ждет подтверждения от консьюмера. если консьюмер не подтвердил получение данных за это время, то брокер считает, что консьюмер умер и перевыдает партиции другим консьюмерам.

#### Настройки offset
* ```auto.offset.reset``` - если консьюмер не смог найти offset для партиции, то он либо начинает читать с самого начала, либо с самого конца.
  * params:
    * ```earliest``` - с самого начала
    * ```latest``` - с самого конца

    
## стратегия назначения партиций
* ```partition.assignment.strategy``` - стратегия назначения партиций
  * params:
    * Round Robin (круговой обход):
    * Range (диапазон):
    * Sticky Assignor (клейкий ассигнер):
    * Custom Assignor (пользовательский ассигнер):

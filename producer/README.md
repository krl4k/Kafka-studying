# Producer
Kafka Producer - это компонент Apache Kafka, отвечающий за отправку сообщений (продюсирование) в темы (topics) Kafka. 
Внутри клиента данные не отправляются сразу - они копятся в батчи и только потом отсылаются.

## Producer client settings
### Основные параметры
* ```bootstrap.servers``` - список брокеров, к которым подключается клиент

#### acks
Количество подтверждений, которые Producer ожидает от брокеров, прежде чем считает сообщение успешно отправленным.

* params:
  * ```0``` - не ждем подтверждения
  * ```1``` - ждем подтверждения от лидера. но мы не знаем среплицировались ли данные на другие реплики или нет
  * ```all``` - ждем подтверждения от всех in-sync реплик.

```min.insync.replicas``` - минимальное количество in-sync реплик, которые должны подтвердить получение данных, чтобы считать сообщение успешно отправленным.

#### retries
Количество попыток отправить сообщение, если оно не было отправлено с первого раза.
* ```retries``` - количество попыток отправить сообщение
* ```retry.backoff.ms``` - время между попытками отправить сообщение


#### batch settings
* ```batch.size``` - размер батча
* ```max.request.bytes``` - максимальный размер запроса
* ```linger.ms``` (BatchTimeout)- время ожидания. если в течении этого времени не набралось batch.size, то данные отправляются.
* ```max.in.flight.requests.per.connection``` - максимальное количество запросов, которые могут быть в процессе отправки на одном соединении.
* ```max.block.ms```: Описание: Максимальное время в миллисекундах, на которое Producer может блокироваться, ожидая места в буфере для отправки.


## key for partition
В Apache Kafka, ключи сообщений используются для определения партиции, в которую будет отправлено сообщение.
Ключ сообщения является произвольным байтовым массивом, который вы указываете при отправке сообщения 
через Kafka Producer. 

`Ключ используется для определения того, в какую партицию темы будет отправлено сообщение.`

Как ключи влияют на отправку в партиции:
* Определение партиции:
  * Kafka использует хеш ключа для определения, в какую из партиций темы будет отправлено сообщение. Это обеспечивает равномерное распределение сообщений между партициями.
* Однозначное отображение:
  * Каждый ключ должен однозначно отображаться на конкретную партицию, чтобы обеспечить предсказуемость и возможность обработки сообщений с одним и тем же ключом в одной и той же партиции.
* Ordering в пределах партиции:
  * Сообщения с одним и тем же ключом отправляются в одну и ту же партицию и обрабатываются в порядке поступления. Это гарантирует упорядоченность сообщений с одинаковым ключом в пределах одной партиции.
  * Если ключи не используются, сообщения отправляются в партиции в случайном порядке, что может привести к потере упорядоченности сообщений.
  * example: ```key = customer_id```

## Producer Idempotence
Idempotence - это свойство, которое гарантирует, что даже если вы отправляете одно и то же сообщение множество раз,
оно будет записано в тему только один раз.
